#!/bin/bash -e

dir="$(mktemp -d)"
pushd "$dir" || exit

trap '
popd || exit
rm -rf "$dir"
' 0

url="https://pkgbuild.com/~tpowa/archboot/iso/x86_64/latest/boot"

for file in {initramfs_x86_64.img,vmlinuz_archboot_x86_64,intel-ucode.img}; do
	dl.sh "$url/$file" "$file"
done

install vmlinuz_archboot_x86_64 /efi/archboot/vmlinuz_archboot_x86_64
cat intel-ucode.img initramfs_x86_64.img | install /dev/stdin /efi/archboot/initramfs_x86_64.img

sbctl sign-all
