#!/bin/bash

if [[ "$EUID" != 0 ]]; then
	exec sudo "$0" "$@"
	exit "$?"
fi

for path in /usr/lib/modules/*; do
	kver="${path##*/}"
	read -r pkgname <"${path}/pkgbase" || continue
	vmlinuz="${path}/vmlinuz"

	echo ":: Reinstalling $pkgname $kver"

	kernel-install add "$@" "$kver" "$vmlinuz"
done
