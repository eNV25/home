#!/bin/bash

if [ "$EUID" != 0 ]; then
	exec sudo "$0" "$@"
	exit $?
fi

for path in /usr/lib/modules/*; do
	kver="${path##*/}"
	read -r kernel <"${path}/pkgbase" || continue
	vmlinuz="${path}/vmlinuz"

	echo ":: Reconfiguring $kernel $kver"

	kernel-install -v add "$@" "$kver" "$vmlinuz" | while read -r line; do
		case "$line" in
		'+'*) ;;
		*) echo "$line" ;;
		esac
	done
done
